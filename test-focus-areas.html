<!DOCTYPE html>
<html>
<head>
    <title>Focus Areas Test</title>
    <script>
        // Mock Chrome API
        window.chrome = {
            runtime: {
                sendMessage: (message, callback) => {
                    console.log('Mock message:', message);
                    if (message.type === 'getAvailableTagsForFocus') {
                        // Mock response
                        callback({
                            ok: true,
                            payload: {
                                access: { core: "confirmed", fundamental: "provisional", advanced: "none" },
                                caps: { core: Infinity, fundamental: 3, advanced: 3 },
                                tags: [
                                    { tagId: "array", name: "Array", tier: "core", selectable: true, reason: "current-tier" },
                                    { tagId: "hash-table", name: "Hash Table", tier: "core", selectable: true, reason: "current-tier" },
                                    { tagId: "string", name: "String", tier: "core", selectable: true, reason: "current-tier" },
                                    { tagId: "two-pointers", name: "Two Pointers", tier: "fundamental", selectable: true, reason: "preview-unlocked" },
                                    { tagId: "sliding-window", name: "Sliding Window", tier: "fundamental", selectable: false, reason: "preview-locked" },
                                    { tagId: "binary-search", name: "Binary Search", tier: "fundamental", selectable: false, reason: "preview-locked" },
                                    { tagId: "dp", name: "Dynamic Programming", tier: "fundamental", selectable: false, reason: "preview-locked" }
                                ],
                                starterCore: [],
                                currentTier: "Core Concept",
                                systemSelectedTags: ["array", "hash-table", "string"],
                                userOverrideTags: [],
                                activeSessionTags: ["array", "hash-table", "string"]
                            }
                        });
                    }
                    return true;
                }
            }
        };

        function testFocusAreas() {
            chrome.runtime.sendMessage({ type: 'getAvailableTagsForFocus', userId: 'test' }, (response) => {
                console.log('Test response:', response);
                document.getElementById('result').innerHTML = `
                    <h3>Test Results:</h3>
                    <p><strong>Status:</strong> ${response.ok ? 'SUCCESS' : 'FAILED'}</p>
                    <p><strong>Current Tier:</strong> ${response.payload?.currentTier}</p>
                    <p><strong>Access:</strong> ${JSON.stringify(response.payload?.access)}</p>
                    <p><strong>System Selected Tags:</strong> ${response.payload?.systemSelectedTags?.join(', ')}</p>
                    <p><strong>User Override Tags:</strong> ${response.payload?.userOverrideTags?.join(', ') || 'None'}</p>
                    <p><strong>Active Session Tags:</strong> ${response.payload?.activeSessionTags?.join(', ')}</p>
                    <p><strong>Total Tags:</strong> ${response.payload?.tags?.length}</p>
                    <p><strong>Selectable Tags:</strong> ${response.payload?.tags?.filter(t => t.selectable).length}</p>
                    <p><strong>Preview Locked:</strong> ${response.payload?.tags?.filter(t => t.reason === "preview-locked").length}</p>
                    <h4>Tags:</h4>
                    <ul>
                        ${response.payload?.tags?.map(tag => 
                            `<li><strong>${tag.name}</strong> (${tag.tier}) - ${tag.selectable ? 'âœ… Selectable' : 'ðŸ”’ Locked'} - ${tag.reason}</li>`
                        ).join('')}
                    </ul>
                `;
            });
        }

        window.onload = () => {
            testFocusAreas();
        };
    </script>
</head>
<body>
    <h1>Focus Areas Enhancement Test</h1>
    <p>Testing the new getAvailableTagsForFocus functionality...</p>
    <div id="result">Loading...</div>
    
    <h2>Expected Behavior:</h2>
    <ul>
        <li>âœ… Shows system-selected tags (what sessions actually use)</li>
        <li>âœ… Shows user override tags (manual selections)</li>
        <li>âœ… Shows active session tags (what will be used in next session)</li>
        <li>âœ… Shows preview tags from next tier based on evidence</li>
        <li>âœ… Includes tier access information (none/provisional/confirmed)</li>
        <li>âœ… Provides starter core tags for new users</li>
        <li>âœ… Works with existing Chrome messaging pattern</li>
        <li>ðŸ†• Fixes disconnect between session creation and focus area UI</li>
    </ul>
</body>
</html>