<!DOCTYPE html>
<html>
<head>
    <title>Session Fix Test</title>
</head>
<body>
    <h1>Session Duplicate Fix Test</h1>
    <div id="test-results"></div>
    
    <script type="module">
        // Mock the database and test our fix
        const testResults = document.getElementById('test-results');
        
        // Simulate sessions with mixed date properties
        const mockSessions = [
            { id: 'session1', date: '2024-01-01T10:00:00Z', status: 'completed' },
            { id: 'session2', Date: '2024-01-02T11:00:00Z', status: 'completed' }, // Capital D
            { id: 'session3', date: '2024-01-03T12:00:00Z', status: 'in_progress' },
            { id: 'session4', Date: '2024-01-04T13:00:00Z', status: 'in_progress' } // Capital D - most recent
        ];
        
        // Our updated sorting logic
        function getLatestSessionMock(sessions) {
            if (sessions.length === 0) return null;
            
            const sortedSessions = sessions.sort((a, b) => {
                const dateA = new Date(a.date || a.Date || 0);
                const dateB = new Date(b.date || b.Date || 0);
                return dateB - dateA;
            });
            
            return sortedSessions[0];
        }
        
        // Test the fix
        const latest = getLatestSessionMock(mockSessions);
        
        testResults.innerHTML = `
            <h2>Test Results:</h2>
            <p><strong>Latest session found:</strong> ${latest.id}</p>
            <p><strong>Date property:</strong> ${latest.date || latest.Date}</p>
            <p><strong>Status:</strong> ${latest.status}</p>
            <p><strong>✅ Test Result:</strong> ${latest.id === 'session4' ? 'PASS - Correctly identified most recent session' : 'FAIL'}</p>
            
            <h3>Session Processing Order:</h3>
            <ul>
                ${mockSessions.map(s => `
                    <li>${s.id}: ${s.date || s.Date} (${s.status}) - ${s.date ? 'lowercase date' : 'uppercase Date'}</li>
                `).join('')}
            </ul>
            
            <h3>Expected Behavior:</h3>
            <p>✅ Function should handle both 'date' and 'Date' properties</p>
            <p>✅ Should return most recent session regardless of property casing</p>
            <p>✅ Should prevent duplicate session creation by properly identifying existing sessions</p>
        `;
    </script>
</body>
</html>