<!DOCTYPE html>
<html>
<head>
    <title>Check Database</title>
</head>
<body>
    <h1>Database Checker</h1>
    <button onclick="checkDatabase()">Check Database Contents</button>
    <pre id="output"></pre>

    <script>
        async function checkDatabase() {
            const output = document.getElementById('output');
            output.textContent = 'Opening database...\n';

            const request = indexedDB.open('leetcode_session_manager', 22);

            request.onsuccess = async (event) => {
                const db = event.target.result;
                output.textContent += 'Database opened successfully!\n\n';

                // Check standard_problems
                output.textContent += '=== STANDARD_PROBLEMS ===\n';
                const stdTx = db.transaction(['standard_problems'], 'readonly');
                const stdStore = stdTx.objectStore('standard_problems');
                const stdCount = await new Promise((resolve) => {
                    const countReq = stdStore.count();
                    countReq.onsuccess = () => resolve(countReq.result);
                });
                output.textContent += 'Total standard problems: ' + stdCount + '\n';

                // Get first 3 standard problems
                const stdGetAll = await new Promise((resolve) => {
                    const getAllReq = stdStore.getAll(null, 3);
                    getAllReq.onsuccess = () => resolve(getAllReq.result);
                });
                output.textContent += 'First 3 problems:\n';
                stdGetAll.forEach((p, i) => {
                    output.textContent += (i + 1) + '. ' + JSON.stringify(p, null, 2) + '\n';
                });

                // Check problems store
                output.textContent += '\n=== PROBLEMS (Leitner) ===\n';
                const probTx = db.transaction(['problems'], 'readonly');
                const probStore = probTx.objectStore('problems');
                const probCount = await new Promise((resolve) => {
                    const countReq = probStore.count();
                    countReq.onsuccess = () => resolve(countReq.result);
                });
                output.textContent += 'Total problems in Leitner system: ' + probCount + '\n';

                // Check sessions
                output.textContent += '\n=== SESSIONS ===\n';
                const sessTx = db.transaction(['sessions'], 'readonly');
                const sessStore = sessTx.objectStore('sessions');
                const sessCount = await new Promise((resolve) => {
                    const countReq = sessStore.count();
                    countReq.onsuccess = () => resolve(countReq.result);
                });
                output.textContent += 'Total sessions: ' + sessCount + '\n';
            };

            request.onerror = () => {
                output.textContent += 'Error opening database: ' + request.error + '\n';
            };
        }
    </script>
</body>
</html>
